{% extends 'partials/layout-main.html' %}
{% load static %}{% load custom_tags %}
{% load custom_tags %}
        
{% block content %}
   <!--begin::Content wrapper-->
   <div class="d-flex flex-column flex-column-fluid">
      <!--begin::Toolbar-->
      <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
         <!--begin::Toolbar container-->
         <div
            id="kt_app_toolbar_container"
            class="app-container container-xxl d-flex flex-stack"
         >
            <!--begin::Page title-->
            <div
               class="page-title d-flex flex-column justify-content-center flex-wrap me-3"
            >
               <!--begin::Title-->
               <h1
                  class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0"
               >
                  Cylinder List
               </h1>
               <!--end::Title-->

               <!--begin::Breadcrumb-->
               <ul
                  class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1"
               >
                  <!--begin::Item-->
                  <li class="breadcrumb-item text-muted">
                     <a
                        href="../../index.html"
                        class="text-muted text-hover-primary"
                     >
                        Home
                     </a>
                  </li>
                  <!--end::Item-->
                  <!--begin::Item-->
                  <li class="breadcrumb-item">
                     <span class="bullet bg-gray-500 w-5px h-2px"></span>
                  </li>
                  <!--end::Item-->

                  <!--begin::Item-->
                  <li class="breadcrumb-item text-muted">Cylinders</li>
                  <!--end::Item-->
               </ul>
               <!--end::Breadcrumb-->
            </div>
            <!--end::Page title-->
            <!--begin::Actions-->
            <div class="d-flex align-items-center gap-2 gap-lg-3">
               

               <!--begin::Secondary button-->
               <!--end::Secondary button-->

               <!--begin::Primary button-->
               <!--end::Primary button-->
            </div>
            <!--end::Actions-->
         </div>
         <!--end::Toolbar container-->
      </div>
      <!--end::Toolbar-->

      <!--begin::Content-->
      <div id="kt_app_content" class="app-content flex-column-fluid">
         <!--begin::Content container-->
         <div id="kt_app_content_container" class="app-container container-xxl">
            <!--begin::Card-->
            <div class="card">
               <!--begin::Card header-->
               <div class="card-header border-0 pt-6">
                  <!--begin::Card title-->
                  <div class="card-title">
                     <!--begin::Search-->
                     <div
                        class="d-flex align-items-center position-relative my-1"
                     >
                        <i
                           class="ki-duotone ki-magnifier fs-3 position-absolute ms-5"
                           ><span class="path1"></span
                           ><span class="path2"></span
                        ></i>
                        <input
                           type="text"
                           data-kt-cylinder-table-filter="search"
                           class="form-control form-control-solid w-250px ps-12"
                           placeholder="Search Cylinders"
                        />
                     </div>
                     <!--end::Search-->
                  </div>
                  <!--begin::Card title-->

                  <!--begin::Card toolbar-->
                  <div class="card-toolbar">
                     <!--begin::Toolbar-->
                     <div
                        class="d-flex justify-content-end"
                        data-kt-cylinder-table-toolbar="base"
                     >
                        

                        <!--begin::Export-->
                        <button
                           type="button"
                           class="btn btn-primary me-3"
                           data-bs-toggle="modal"
                           data-bs-target="#kt_modal_add_cylinder"
                        >
                           <i class="ki-duotone ki-plus fs-2"
                              ><span class="path1"></span
                              ><span class="path2"></span
                           ></i>
                           Add Bulk Cylinders
                        </button>
                        <!--end::Export-->
                     </div>
                     <!--end::Toolbar-->

                     <!--begin::Group actions-->
                     <div
                        class="d-flex justify-content-end align-items-center d-none"
                        data-kt-cylinder-table-toolbar="selected"
                     >
                        <div class="fw-bold me-5">
                           <span
                              class="me-2"
                              data-kt-cylinder-table-select="selected_count"
                           ></span>
                           Selected
                        </div>

                        <button
                           type="button"
                           class="btn btn-danger"
                           data-kt-cylinder-table-select="delete_selected"
                        >
                           Delete Selected
                        </button>
                     </div>
                     <!--end::Group actions-->
                  </div>
                  <!--end::Card toolbar-->
               </div>
               <!--end::Card header-->

               <!--begin::Card body-->
               <div class="card-body pt-0">
                  <!--begin::Table-->
                  <table
                     class="table align-middle table-row-dashed fs-6 gy-5"
                     id="kt_cylinder_table"
                  >
                     <thead>
                        <tr
                           class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0"
                        >
                           <th class="w-10px pe-2">
                              <div
                                 class="form-check form-check-sm form-check-custom form-check-solid me-3"
                              >
                                 <input
                                    class="form-check-input"
                                    type="checkbox"
                                    data-kt-check="true"
                                    data-kt-check-target="#kt_cylinder_table .form-check-input"
                                    value="1"
                                 />
                              </div>
                           </th>
                           <th class="min-w-125px" data-priority="1">Item</th>
                           <th class="min-w-125px">Cylinder Site</th>
                           <th class="min-w-125px">Status</th>
                           <th class="min-w-125px">QTY Status</th>
                           <th class="min-w-125px">QTY Left</th>
                           <th class="min-w-125px">Created Date</th>
                           {% comment %} <th class="text-end min-w-70px">Actions</th> {% endcomment %}
                        </tr>
                     </thead>
                     <tbody class="fw-semibold text-gray-600">
                        {% for c in cylinders %}
                        <tr>
                           <td>
                              <div
                                 class="form-check form-check-sm form-check-custom form-check-solid"
                              >
                                 <input
                                    class="form-check-input"
                                    type="checkbox"
                                    value="1"
                                 />
                              </div>
                           </td>

                           <td>
                              <a
                                 href="#!" id="kt_modal_1{{c.id}}" data-bs-toggle="modal"
                           data-bs-target="#kt_modal_1{{c.id}}"
                                 class="text-gray-800 text-hover-primary mb-1"
                                 >{{ c.item }}</a
                              >
                           </td>
                           <td>
                              <a
                                 href="/cylinders/{{ c.id }}/"
                                 class="text-gray-600 text-hover-primary mb-1"
                                 >
                                 {% get_site_name c.location %}
                                 
                                 </a
                              >
                           </td>
                           <td>
                              
                              {% if c.status == 'full' %}
                              <div class="badge badge-light-success fw-bold">Full</div>
                              {% elif c.status == 'empty' %}
                              <div class="badge badge-light-danger fw-bold">Empty</div>
                              {% elif c.status == 'in_use' %}
                              <div class="badge badge-light-primary fw-bold">In Use</div>
                              {% elif c.status == 'maintenance' %}
                              <div class="badge badge-light-warning fw-bold">Maintenance</div>
                              {% elif c.status == 'retired' %}
                              <div class="badge badge-light fw-bold">Retired</div>
                              {% endif %}
                           </td>
                           <td>
                              <div class="badge {{ c.lpg_level_status.0 }} fw-bold">
                                 {{ c.lpg_level_status.1 }}
                              </div>
                           </td>
                           <td data-filter="full">
                              
                              {% remaining_quantity c %}
                           </td>
                           <td>{{ c.created_at }}</td>
                           

                           <div class="modal fade" tabindex="-1" id="kt_modal_1{{c.id}}">
                  <div class="modal-dialog">
                     <div class="modal-content">
                           <div class="modal-header">
                              
                              <h3 class="modal-title">Cylinder Information</h3>
                              
                              <!--begin::Close-->
                              <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                                 <i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
                              </div>
                              <!--end::Close-->
                              
                           </div>

                           <div class="modal-body">
                              {% comment %} {% for x in cylinder %} {% endcomment %}
                              {% comment %} {% if x.id|stringformat:"s" == c.qrcode %} {% endcomment %}

                              <div class="card-body p-2">
                                 <div class="fs-2hx fw-bold">
                                 K {% cylinder_dispense_sales c.id %}</div>
                                 <div class="fs-4 fw-semibold text-gray-500 mb-7">Refill Sales</div>



                                 <div class="fs-6 d-flex justify-content-between my-4">
                                       <div class="fw-semibold">Product Remaining</div>

                                       <div class="d-flex fw-bold">
                                          <i class="ki-duotone ki-arrow-up-right fs-3 me-1 text-success"><span class="path1"></span><span class="path2"></span></i>
                                             {% remaining_quantity c %}
                                       </div>
                                 </div>

                                 <div class="separator separator-dashed"></div>

                                 <div class="fs-6 d-flex justify-content-between mt-4 mb-4">
                                       <div class="fw-semibold">Cylinder Status</div>

                                       <div class="d-flex fw-bold">
                                          <i class="ki-duotone ki-arrow-up-right fs-3 me-1 text-success"><span class="path1"></span><span class="path2"></span></i>
                                          {% if c.status == 'full' %}
                                          <div class="badge badge-light-success fw-bold">Full</div>
                                          {% elif c.status == 'empty' %}
                                          <div class="badge badge-light-danger fw-bold">Empty</div>
                                          {% elif c.status == 'in_use' %}
                                          <div class="badge badge-light-primary fw-bold">In Use</div>
                                          {% elif c.status == 'maintenance' %}
                                          <div class="badge badge-light-warning fw-bold">Maintenance</div>
                                          {% elif c.status == 'retired' %}
                                          <div class="badge badge-light fw-bold">Retired</div>
                                          {% endif %}
                                          <div class="badge {{ c.lpg_level_status.0 }} fw-bold mx-3">
                                             {{ c.lpg_level_status.1 }}
                                          </div>
                                       </div>
                                 </div>

                                 <div class="separator separator-dashed"></div>

                                 <div class="fs-6 d-flex justify-content-between mt-4 mb-4">
                                       <div class="fw-semibold">Assigned Location</div>

                                       <div class="d-flex fw-bold">
                                          <i class="ki-duotone ki-arrow-up-right fs-3 me-1 text-success"><span class="path1"></span><span class="path2"></span></i>
                                             {% get_site_name c.location %}
                                       </div>
                                 </div>

                                 <div class="separator separator-dashed"></div>

                                 <div class="fs-6 d-flex justify-content-between mt-4 mb-4">
                                       <div class="fw-semibold">Number of Refills</div>

                                       <div class="d-flex fw-bold">
                                          <i class="ki-duotone ki-arrow-up-right fs-3 me-1 text-success"><span class="path1"></span><span class="path2"></span></i>
                                             {% get_refill_count c.id %}
                                       </div>
                                 </div>

                                 <div class="separator separator-dashed"></div>

                              </div>
                              {% comment %} {% endif %} {% endcomment %}
                              {% comment %} {% endfor %} {% endcomment %}
                           </div>

                                 <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                 </div>
                           </div>
                        </div>
                        </tr>
                        {% empty %}
                        <tr>
                            <td></td>
                            <td>N/A</td>
                            <td>N/A</td>
                            <td>N/A</td>
                            <td>N/A</td>
                            <td>N/A</td>
                            <td>N/A</td>
                        </tr>
                        {% endfor %}
                     </tbody>
                  </table>
                  <!--end::Table-->
               </div>
               <!--end::Card body-->
            </div>
            <!--end::Card-->
            
            <!--begin::Modal - Adjust Balance-->
            <div
               class="modal fade"
               id="kt_modal_add_cylinder"
               tabindex="-1"
               aria-hidden="true"
            >
               <!--begin::Modal dialog-->
               <div class="modal-dialog modal-dialog-centered mw-650px">
                  <!--begin::Modal content-->
                  <div class="modal-content">
                     <!--begin::Modal header-->
                     <div class="modal-header">
                        <!--begin::Modal title-->
                        <h2 class="fw-bold">Add Bulk Cylinders</h2>
                        <!--end::Modal title-->

                        <!--begin::Close-->
                        <div
                           id="kt_modal_add_cylinder_close"
                           class="btn btn-icon btn-sm btn-active-icon-primary"
                           data-bs-dismiss="modal" aria-label="Close"
                        >
                           <i class="ki-duotone ki-cross fs-1"
                              ><span class="path1"></span
                              ><span class="path2"></span
                           ></i>
                        </div>
                        <!--end::Close-->
                     </div>
                     <!--end::Modal header-->

                     <!--begin::Modal body-->
                     <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
                        <!--begin::Form-->
                        <form
                           id="kt_modal_add_cylinder_form"
                           class="form"
                           action="/cylinders/bulk/"
                           method="POST"
                           data-kt-redirect="/cylinders/bulk/"
                           target="_blank"
                        >
                        {% csrf_token %}
                           <!--begin::Input group-->
                           <div class="fv-row mb-10">
                              <!--begin::Label-->
                              <label class="fs-5 fw-semibold form-label mb-5"
                                 >Select Cylinder Size:</label
                              >
                              <!--end::Label-->

                              <!--begin::Input-->
                              <select
                                 name="cylinder_size"
                                 data-control="select2"
                                 data-placeholder="Select a format"
                                 data-hide-search="true"
                                 name="format"
                                 id="cylinder-size"
                                 class="form-select form-select-solid"
                              >
                              {% for i in cylinder_type %}
                                 <option value="{{i.id}}">{{i.name}} - {{i.size_kg}}kg</option>
                              {% empty %}
                                 <option value="" disabled selected>Please Complete Setup</option>
                              {% endfor %}
                              </select>
                              <!--end::Input-->
                           </div>
                           <!--end::Input group-->

                           <!--begin::Input group-->
                           <div class="fv-row mb-10">
                              <!--begin::Label-->
                              <label class="fs-5 fw-semibold form-label mb-5"
                                 >Number of Cylinders:</label
                              >
                              <!--end::Label-->

                              <!--begin::Input-->
                              <input type="number"
                                 class="form-control form-control-solid"
                                 placeholder="1"
                                 value="1"
                                 id="qty-value"
                                 name="qty"
                              />
                              <!--end::Input-->
                           </div>
                           <!--end::Input group-->

                           

                           <!--begin::Actions-->
                           <div class="text-center">
                              <button
                                 type="reset"
                                 id="kt_modal_add_cylinder_cancel"
                                 class="btn btn-light me-3"
                                 data-bs-dismiss="modal" aria-label="Close"
                              >
                                 Discard
                              </button>

                              <button
                                 type="submit"
                                 id="kt_modal_add_cylinder_submit"
                                 class="btn btn-primary"
                              >
                                 <span class="indicator-label"> Generate QR Codes </span>
                                 <span class="indicator-progress">
                                    Please wait...
                                    <span
                                       class="spinner-border spinner-border-sm align-middle ms-2"
                                    ></span>
                                 </span>
                              </button>
                           </div>
                           <!--end::Actions-->
                        </form>
                        <!--end::Form-->
                     </div>
                     <!--end::Modal body-->
                  </div>
                  <!--end::Modal content-->
               </div>
               <!--end::Modal dialog-->
            </div>
            <!--end::Modal - New Card--><!--end::Modals-->
         </div>
         <!--end::Content container-->
      </div>
      <!--end::Content-->
   </div>
   <!--end::Content wrapper-->
   
{% endblock %}

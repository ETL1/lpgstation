{% load static %}{% load custom_tags %}
<!DOCTYPE html>

<html lang="en">
   <!--begin::Head-->
   <meta
      http-equiv="content-type"
      content="text/html;charset=UTF-8"
   /><!-- /Added by HTTrack -->
   <head>
      <title>{% block title %}{% endblock %}</title>
      <meta charset="utf-8" />
      <meta
         name="description"
         content=""
      />
      <meta
         name="keywords"
         content=""
      />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <meta property="og:locale" content="en_US" />
      <meta property="og:type" content="article" />
      <meta
         property="og:title"
         content="Vivo Platform"
      />
      <meta property="og:url" content="" />
      <meta property="og:site_name" content="Vivo Track & Trace" />
      {% comment %} <link rel="canonical" href="" /> {% endcomment %}
      <link
         rel="shortcut icon"
         href="{% static 'assets/media/logos/favicon.ico' %}"
      />

      <!--begin::Fonts(mandatory for all pages)-->
      {% comment %} <link
         rel="stylesheet"
         href="{% static 'fonts.googleapis.com/css7b91?family=Inter:300,400,500,600,700' %}"
      /> {% endcomment %}
      <!--end::Fonts-->

      <!--begin::Vendor Stylesheets(used for this page only)-->
      <link
         href="{% static 'assets/plugins/custom/fullcalendar/fullcalendar.bundle.css' %}"
         rel="stylesheet"
         type="text/css"
      />
      <link
         href="{% static 'assets/plugins/custom/datatables/datatables.bundle.css' %}"
         rel="stylesheet"
         type="text/css"
      />
      <!--end::Vendor Stylesheets-->

      <!--begin::Global Stylesheets Bundle(mandatory for all pages)-->
      <link
         href="{% static 'assets/plugins/global/plugins.bundle.css' %}"
         rel="stylesheet"
         type="text/css"
      />
      <link
         href="{% static 'assets/css/style.bundle.css' %}"
         rel="stylesheet"
         type="text/css"
      />
      <!--end::Global Stylesheets Bundle-->

      <!--begin::Google tag-->
      {% comment %} <script
         async
         src="https://www.googletagmanager.com/gtag/js?id=UA-37564768-1"
      ></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag() {
            dataLayer.push(arguments);
         }
         gtag("js", new Date());
         gtag("config", "UA-37564768-1");
      </script> {% endcomment %}
      <!--end::Google tag-->
      <script>
         // Frame-busting to prevent site from being loaded within a frame without permission (click-jacking)
         if (window.top != window.self) {
            window.top.location.replace(window.self.location.href);
         }
      </script>
   </head>
   <!--end::Head-->

   <!--begin::Body-->
   <body
      id="kt_app_body"
      data-kt-app-layout="dark-sidebar"
      {% comment %} data-kt-app-layout="light-sidebar" {% endcomment %}
      data-kt-app-header-fixed="true"
      data-kt-app-sidebar-enabled="true"
      data-kt-app-sidebar-fixed="true"
      data-kt-app-sidebar-hoverable="true"
      data-kt-app-sidebar-push-header="true"
      data-kt-app-sidebar-push-toolbar="true"
      data-kt-app-sidebar-push-footer="true"
      data-kt-app-toolbar-enabled="true"
      class="app-default"
   >
      <!--begin::Theme mode setup on page load-->
      <script>
         var defaultThemeMode = "light";
         var themeMode;

         if (document.documentElement) {
            if (document.documentElement.hasAttribute("data-bs-theme-mode")) {
               themeMode =
                  document.documentElement.getAttribute("data-bs-theme-mode");
            } else {
               if (localStorage.getItem("data-bs-theme") !== null) {
                  themeMode = localStorage.getItem("data-bs-theme");
               } else {
                  themeMode = defaultThemeMode;
               }
            }

            if (themeMode === "system") {
               themeMode = window.matchMedia("(prefers-color-scheme: dark)")
                  .matches
                  ? "dark"
                  : "light";
            }

            document.documentElement.setAttribute("data-bs-theme", themeMode);
         }
      </script>
      <!--end::Theme mode setup on page load-->

      <!--begin::App-->
    <div class="d-flex flex-column flex-root app-root" id="kt_app_root">
         <!--begin::Page-->
        <div class="app-page flex-column flex-column-fluid" id="kt_app_page">
            
            {% include 'partials/_header.html' %}
            {% include 'partials/_sidebar.html' %}

               <!--begin::Main-->
                <div
                  class="app-main flex-column flex-row-fluid"
                  id="kt_app_main">
                  <!--begin::Content wrapper-->
                  {% block content %}{% endblock %}
                  <!--end::Content wrapper-->

                  {% include 'partials/_footer.html' %}
               
                </div>
               <!--end:::Main-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Page-->
    </div>
    <!--end::App-->

    <!-- Admin Password Confirmation Modal -->
      <div class="modal fade" id="adminPasswordModal" tabindex="-1" aria-labelledby="adminPasswordModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content border-0 shadow">
            <div class="modal-header bg-dark text-white">
            <h5 class="modal-title" id="adminPasswordModalLabel">Admin Authorization Required</h5>
            <button type="button" class="btn-close bg-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <p class="mb-3">Please enter the admin credentials to continue.</p>
            <input type="text" id="adminUsernameInput" class="form-control" placeholder="Enter Admin Username"><br/>
            <input type="password" id="adminPasswordInput" class="form-control" placeholder="Enter Admin password">
            <div id="adminAuthError" class="text-danger mt-2 d-none">Invalid password. Please try again.</div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" id="adminConfirmBtn" class="btn btn-primary">Confirm</button>
            </div>
         </div>
      </div>
      </div>


    <script>
      {% comment %} document.addEventListener("DOMContentLoaded", function () {
         let pendingActionUrl = null;

         // Intercept all delete/edit buttons (add class="requires-admin" to them)
         document.querySelectorAll(".requires-admin").forEach(button => {
            button.addEventListener("click", function (e) {
                  e.preventDefault();
                  pendingActionUrl = this.getAttribute("data-action-url");
                  new bootstrap.Modal(document.getElementById("adminPasswordModal")).show();
            });
         });

         // Handle confirmation
         document.getElementById("adminConfirmBtn").addEventListener("click", function () {
            const password = document.getElementById("adminPasswordInput").value;
            const username = document.getElementById("adminUsernameInput").value;

            fetch("/verify-admin-password/", {
                  method: "POST",
                  headers: { "X-CSRFToken": getCookie("csrftoken") },
                  body: new URLSearchParams({ password, username })
            })
            .then(res => res.json())
            .then(data => {
                  if (data.success) {
                     // Authorized — proceed with action
                     window.location.href = pendingActionUrl;
                  } else {
                     document.getElementById("adminAuthError").classList.remove("d-none");
                  }
            });
         });

         // Helper to get CSRF token
         function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                  const cookies = document.cookie.split(";");
                  for (let i = 0; i < cookies.length; i++) {
                     const cookie = cookies[i].trim();
                     if (cookie.substring(0, name.length + 1) === name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                     }
                  }
            }
            return cookieValue;
         }
      }); {% endcomment %}
      document.addEventListener("DOMContentLoaded", function () {
      let pendingFormId = null;

      // Intercept all buttons that need admin approval
      document.querySelectorAll(".requires-admin").forEach(button => {
         button.addEventListener("click", function (e) {
            e.preventDefault();
            pendingFormId = this.getAttribute("data-form-id");
            new bootstrap.Modal(document.getElementById("adminPasswordModal")).show();
         });
      });

      // Handle admin confirmation
      document.getElementById("adminConfirmBtn").addEventListener("click", function () {
         const password = document.getElementById("adminPasswordInput").value;
         const username = document.getElementById("adminUsernameInput").value;

         fetch("/verify-admin-password/", {
            method: "POST",
            headers: {
            "X-CSRFToken": getCookie("csrftoken"),
            "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({ password, username })
         })
         .then(res => res.json())
         .then(data => {
            if (data.success) {
            const modalEl = document.getElementById("adminPasswordModal");
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();

            // ✅ Now submit the pending form
            if (pendingFormId) {
               document.getElementById(pendingFormId).submit();
            }
            } else {
            document.getElementById("adminAuthError").classList.remove("d-none");
            }
         });
      });

      // Helper to get CSRF token
      function getCookie(name) {
         let cookieValue = null;
         if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + "=")) {
               cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
               break;
            }
            }
         }
         return cookieValue;
      }
      });

      </script>



      <!--begin::Javascript-->
      {% comment %} <script>
         var hostUrl = "assets/index.html";
      </script> {% endcomment %}

      <!--begin::Global Javascript Bundle(mandatory for all pages)-->
      <script src="{% static 'assets/plugins/global/plugins.bundle.js' %}"></script>
      <script src="{% static 'assets/js/scripts.bundle.js' %}"></script>
      <!--end::Global Javascript Bundle-->

      <!--begin::Vendors Javascript(used for this page only)-->
      <script src="{% static 'assets/plugins/custom/fullcalendar/fullcalendar.bundle.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/index.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/xy.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/percent.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/radar.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/themes/Animated.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/map.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/geodata/worldLow.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/geodata/continentsLow.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/geodata/usaLow.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/geodata/worldTimeZonesLow.js' %}"></script>
      <script src="{% static 'cdn.amcharts.com/lib/5/geodata/worldTimeZoneAreasLow.js' %}"></script>
      <script src="{% static 'assets/plugins/custom/datatables/datatables.bundle.js' %}"></script>
      <!--end::Vendors Javascript-->

      <!--begin::Custom Javascript(used for this page only)-->
      {% if request.path == '/customers/' %}
      <script src="{% static 'assets/js/custom/apps/customers/list/export.js' %}"></script>{% endif %}
      
      {% if request.path == '/customers/' %}
      <script src="{% static 'assets/js/custom/apps/customers/list/list.js' %}"></script>{% endif %}
      
      {% if request.path == '/customers/' %}
      <script src="{% static 'assets/js/custom/apps/customers/add.js' %}"></script>{% endif %}
      
      {% if request.path == '/grn/new/' %}
      <script src="{% static 'assets/js/custom/apps/invoices/create.js' %}"></script>{% endif %}

      {% if request.resolver_match.url_name == "cylinder-list" %}
         {% comment %} <script src="{% static 'assets/js/custom/apps/cylinders/add.js' %}"></script> {% endcomment %}
         <script src="{% static 'assets/js/custom/apps/cylinders/list/list.js' %}"></script>
      {% endif %}

      {% if request.path == '/refills/' %}
      <script src="{% static 'assets/js/custom/apps/cylinders/list/list.js' %}"></script>{% endif %}

      {% if request.resolver_match.url_name == "container-detail"  %}
         <script src="{% static 'assets/js/custom/apps/containers/add.js' %}"></script>
      {% endif %}

      {% if request.path == "/products/" %}
         <script src="{% static 'assets/js/custom/apps/products/list/list.js' %}"></script>
         <script src="{% static 'assets/js/custom/apps/products/add.js' %}"></script>
      {% endif %}
      
      {% if request.path == '/token/' %}
         <script src="{% static 'assets/js/custom/utilities/modals/bidding.js'%}"></script>
      {% endif %}
      
      {% if request.path == '/containers/' %}
         <script src="{% static 'assets/js/custom/apps/containers/list/list.js' %}"></script>
         <script src="{% static 'assets/js/custom/apps/containers/add.js' %}"></script>
      {% endif %}
      
      <script src="{% static 'assets/js/widgets.bundle.js' %}"></script>
      <script src="{% static 'assets/js/custom/utilities/modals/create-campaign.js' %}"></script>
      <script src="{% static 'assets/js/custom/utilities/modals/users-search.js' %}"></script>
      <!--end::Custom Javascript-->
      <!--end::Javascript-->
   </body>
   <!--end::Body-->
</html>
